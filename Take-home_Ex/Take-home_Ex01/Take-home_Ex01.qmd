---
title: "Take-home Exercise 1"
author: "Jaya George"
date: "April 17,2024"
date-modified: "last-modified"
execute: 
  eval: true
  echo: true
  warning: false
  freeze: true
---

# *Creating data visualization beyond default*

## Overview

### Setting the scene

### Our task

## Getting started

### Load packages

We load the following R packages using the `pacman::p_load()` function:

-   **tidyverse**: Core collection of R packages designed for data science

-   **haven**: To read in data formats such as SAS and SPSS

-   **ggrepel**: to provides geoms for **ggplot2** to repel overlapping text labels

-   **ggthemes**: to use additional themes for **ggplot2**

-   **patchwork**: to prepare composite figure created using **ggplot2**

-   **ggridges**: to plot ridgeline plots

-   **ggdist**: for visualizations of distributions and uncertainty

-   **scales**: provides the internal scaling infrastructure used by **ggplot2**

```{r}
library("pacman")
```

```{r}
pacman::p_load(tidyverse, haven,
               ggrepel, ggthemes,
               ggridges, ggdist,
               patchwork, scales)
```

```{r}
library(readr)
```

# *Import data*

```{r}
res_data1 <- read_csv("data/ResidentialTransaction20240308160536.csv",show_col_types = FALSE)
res_data2 <- read_csv("data/ResidentialTransaction20240308160736.csv",show_col_types = FALSE)
res_data3 <- read_csv("data/ResidentialTransaction20240308161009.csv",show_col_types = FALSE)
res_data4 <- read_csv("data/ResidentialTransaction20240308161109.csv",show_col_types = FALSE)
res_data5 <- read_csv("data/ResidentialTransaction20240414220633.csv",show_col_types = FALSE)
res_data <- bind_rows(res_data1, res_data2, res_data3, res_data4, res_data5)

```

### Data pre-processing

```{r}
nrow(res_data)

```

#### **Glimpse of data**

```{r}
glimpse(res_data)
```

#### **Check for duplicates**

```{r}
res_data[duplicated(res_data),]
```

#### **Filtering data for selected variables**

```{r}
res_data_final = res_data %>% 
  select("Property Type", "Area (SQFT)","Unit Price ($ PSF)","Sale Date","Transacted Price ($)","Postal District","Type of Sale","Planning Region","Planning Area","Purchaser Address Indicator") %>%
  rename("Property_Type" = "Property Type",
         "Area_sqft" = "Area (SQFT)",
         "Unit_Price_sqft"="Unit Price ($ PSF)",
         "Sale_Date"="Sale Date",
         "Sale_Price"="Transacted Price ($)",
         "Postal_District"="Postal District",
         "Sale_Type"="Type of Sale",
         "Planning_Region"="Planning Region",
         "Planning_Area"="Planning Area",
         "Purchaser_Address_Indicator"="Purchaser Address Indicator")
```

## **Handling missing values**

```{r}
sum(is.na(res_data_final$Property_Type))
```

```{r}
sum(is.na(res_data_final$Area_sqft))
```

```{r}
sum(is.na(res_data_final$Unit_Price_sqft))
```

```{r}
sum(is.na(res_data_final$Sale_Date))
```

```{r}
sum(is.na(res_data_final$Sale_Price))
```

```{r}
sum(is.na(res_data_final$Postal_District))
```

```{r}
sum(is.na(res_data_final$Sale_Type))
```

```{r}
sum(is.na(res_data_final$Planning_Region))
```

```{r}
sum(is.na(res_data_final$Planning_Area))
```

```{r}
# Create the ridge plot
SES_ridgeplot <-ggplot(res_data_final, aes(x = Unit_Price_sqft, y = Property_Type, fill = 0.5 - abs(0.5 - stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", calc_ecdf = TRUE) +
  scale_fill_viridis_c(name = "Tail probability", direction = -1) +
  facet_wrap(~ Subject, scales = "free_x") + # Faceting by subject
  labs(title = "Students with more advantageous socioeconomic status tend to perform better",
       subtitle = "Density plots of performance stratified by socioeconomic status",
       x = "Score") +
  scale_x_continuous(limits = c(0, 1000)) + 
  theme_minimal() +
  theme(legend.position = "none", # Hides the legend
        axis.title.x = element_blank(), # Hides the x-axis title
        axis.title.y = element_blank(),
        axis.text.x = element_blank(), # Hides the x-axis text/numbers
        axis.ticks.x = element_blank(), # Hides the x-axis ticks
        plot.title = element_text(face = "bold", size = 12),
        plot.subtitle = element_text(size = 8))

SES_ridgeplot


```

```{r}
# Load necessary libraries
library(ggplot2)
library(ggridges)

# Assume you have a dataframe `df` with a numeric variable `value`
# and a categorical variable `category` that you want to plot

# Basic ridge plot
ggplot(res_data_final, aes(x = Unit_Price_sqft, y = Property_Type, fill = Property_Type)) +
  geom_density_ridges() +
  theme_ridges() + # this is optional, for a better theme tailored for ridge plots
  labs(title = 'Ridge Plot', x = 'Value', y = 'Category')

```

```{r, fig.width=20, fig.height=10}
# Create the box plot
ggplot(res_data_final, aes(x = Property_Type, y = Unit_Price_sqft)) +
  geom_boxplot() +  facet_wrap(~ Planning_Region) +
  labs(
    title = "Price Distribution by Property Type (Q1 2024)",
    x = "Property Type",
    y = "Price"
  ) +
  scale_y_continuous(breaks = seq(0, max(res_data_final$Unit_Price_sqft), by = 500))+
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) # Rotate x-axis labels


```

```{r, fig.width=15, fig.height=8}
# Create the box plot
ggplot(res_data_final, aes(x = Property_Type, y = Unit_Price_sqft)) +
  geom_boxplot() +  facet_grid(~ Planning_Region) +
  labs(
    title = "Price Distribution by Property Type (Q1 2024)",
    x = "Property Type",
    y = "Price"
  ) +
  scale_y_continuous(breaks = seq(0, max(res_data_final$Unit_Price_sqft), by = 500))+
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) # Rotate x-axis labels


```

```{r}
# Pre-calculate the count of transactions in each combination (Planning Region, Property Type)
transaction_counts <- res_data_final %>%
  count(Property_Type,Planning_Region)  

# Create the heatmap with calculated counts
ggplot(transaction_counts, aes(x = Property_Type, y = Planning_Region)) +
  geom_tile(aes(fill = n), colour = "white") +  # Use 'n' (count) for fill intensity
  scale_color_viridis_c()+
  labs(
    x = "Planning Region",
    y = "Property Type",
    title = "Count of Property Sales by Planning Region and Property Type"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels for readability

```

```{r}

transaction_counts <- res_data_final %>%
  count(Property_Type, Sale_Type) 

ggplot(transaction_counts, aes(x = Property_Type, y = n, fill = Sale_Type)) +
  geom_bar(stat = "identity", position = "stack") + 
  labs(
    title = "Transaction Count by Property Type and Sale Type (Q1 2024)",
    x = "Property Type",
    y = "Number of Transactions"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
```

```{r}
library(ggplot2)
library(forcats) # for working with factors

# Assuming your data is in a dataframe called 'df'
# Rotate the y-axis labels for better readability
p <- ggplot(res_data_final, aes(x = fct_reorder(Planning_Region, n), y = fct_reorder(Property_Type, n), fill = n)) +
  geom_tile() +
  scale_fill_gradient(low = "white", high = "steelblue") + # Use a gradient that works well for counts
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x labels for better fit
    axis.text.y = element_text(size = 8) # Adjust text size as needed
  ) +
  labs(x = "Planning Region", y = "Property Type", fill = "Count") # Label your axes and legend

# Print the plot
print(p)


```

```{r}
# Pre-calculate the count of transactions in each combination (Planning Region, Property Type)
transaction_counts <- res_data_final %>%
  count(Property_Type,Planning_Area)  

# Create the heatmap with calculated counts
ggplot(transaction_counts, aes(x = Property_Type, y = Planning_Area)) +
  geom_tile(aes(fill = n), colour = "white") +  # Use 'n' (count) for fill intensity
  scale_color_viridis_c()+
  labs(
    x = "Planning Region",
    y = "Property Type",
    title = "Count of Property Sales by Planning Region and Property Type"
  ) +
   theme(axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x labels for better fit
    axis.text.y = element_text(size = 5)) # Adjust text size as needed
	

```

```{r}

transaction_counts <- res_data_final %>%
  count(Planning_Region,Property_Type) 

ggplot(transaction_counts, aes(x = Planning_Region, y = n, fill = Property_Type)) +
  geom_bar(stat = "identity", position = "stack") + 
  labs(
    title = "Transaction Count by Property Type and Sale Type (Q1 2024)",
    x = "Property Type",
    y = "Number of Transactions"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
```

```{r, fig.width=12, fig.height=6}


transaction_counts <- res_data_final %>%
  count(Planning_Area,Property_Type) 

ggplot(transaction_counts, aes(x = Planning_Area, y = n, fill = Property_Type)) +
  geom_bar(stat = "identity", position = "stack") + 
  labs(
    title = "Transaction Count by Property Type and Sale Type (Q1 2024)",
    x = "Property Type",
    y = "Number of Transactions"
  ) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) 
```

```{r}
library(ggplot2)
library(tidyverse)  # Might be needed 

# Assuming your data is in a data frame called 'realis_data' 
# Replace with your actual column names

ggplot(res_data_final, aes(x = Unit_Price_sqft,fill = Sale_Type)) +
  geom_histogram(bins = 30) +  # Adjust 'bins' for desired resolution
  labs(
    x = "Unit Size",
    y = "Count",
    title = "Distribution of Unit Size by Planning Region and Sale Type"
  ) +
  theme(strip.text = element_text(size = 10))  # Adjust strip text size, if needed

```

```{r}
library(ggplot2)

# Assuming your data is in a dataframe called `df`
# with 'unit_size' and 'sale_type' columns
ggplot(res_data_final, aes(x = Unit_Price_sqft, fill = Sale_Type)) + 
  geom_histogram(position = "dodge", binwidth = 20) + 
  labs(title = "Distribution of Unit Size by Sale Type",
       x = "Unit Size",
       y = "Count") + 
  scale_x_continuous(breaks = seq(0, max(res_data_final$Unit_Price_sqft), by = 500))+
  scale_fill_brewer(palette = "Set1")  # Optional: Adds a color palette

```

```{r}
ggplot(data=res_data_final, 
       aes(x= Unit_Price_sqft, 
           fill = Sale_Type)) +  facet_grid(Planning_Region)
  geom_histogram(bins=20, 
                 color="grey30")
```

```{r}
ggplot(data=res_data_final, 
       aes(x = Unit_Price_sqft,colour = Sale_Type)) +
  geom_density()           
```

```{r}

ggplot(data=res_data_final, 
       aes(x = Area_sqft,colour = Sale_Type)) +
  geom_density()  
```
